# BKD-003.a ‚Äî Design dos endpoints de Transactions

- **ID:** BKD-003.a
- **T√≠tulo:** Design dos endpoints e contratos (list, create, update, delete, filtros)

## Checklist

- [x] Definir query params e payloads (categoria, date, type, cardId)
- [x] Mapear pagina√ß√£o/limites e formatos de resposta
- [x] Definir c√≥digos de erro e valida√ß√µes

## Detalhes

- **Prioridade:** üî¥ Cr√≠tica
- **Estimativa:** 1h
- **Depend√™ncias:** BKD-002
- **Arquivos alvo:** `docs/development/TASKS/PHASE-1-MVP.md` (refer√™ncia)

### Contratos definidos

- **Endpoints (Server Functions):**
  - `GET /transactions` ‚Äî filtros: `month` (1-12, se informado e `year` ausente assume ano atual), `year` (2000-2100), `type` (`CREDIT`/`DEBIT`), `category` (string trim), `cardId`, `subscriptionId`, `page` (>=1, default 1), `perPage` (default 20, m√°x. 50). Ordena√ß√£o: `date desc, createdAt desc`.
  - `POST /transactions` ‚Äî payload obrigat√≥rio: `type`, `value > 0`, `description`, `category`, `date`; opcionais: `cardId`, `subscriptionId` (devem pertencer ao usu√°rio).
  - `PUT /transactions/:id` ‚Äî payload parcial com mesmas regras do POST; exige ownership do `id`.
  - `DELETE /transactions/:id` ‚Äî exige ownership; dele√ß√£o hard (schema n√£o prev√™ soft delete).
- **Resposta padr√£o (DTO):** `transaction` com `id, type, value (number), description, category, date ISO, cardId, subscriptionId, createdAt, updatedAt`. Listagem retorna `items`, `total`, `page`, `perPage`, `hasNextPage`, `appliedFilters`.
- **Saldo calculado no servidor:** respostas de create/update/delete retornam `balanceDelta` (CREDIT = +value, DEBIT = -value; update retorna delta entre estados; delete retorna inverso do impacto original).
- **Valida√ß√µes e erros:** `VALIDATION_ERROR`, `UNAUTHORIZED` (session), `TRANSACTION_NOT_FOUND`, `FORBIDDEN` (owner), `FOREIGN_RELATION_INVALID` (card/subscription n√£o pertencem ao usu√°rio).
